<app-header></app-header>

<ion-content [fullscreen]="true">
  <div class="tab-container">
    <div class="chat-messages">
      @for (message of chatService.messages(); track message.timestamp) {
        <div
          [ngClass]="{
            'user-message': message.sender === 'user',
            'system-message': message.sender === 'system',
          }"
        >
          <div class="message-header">
            <strong>{{ message.sender === 'user' ? content().userTitle : 'ClosBot' }} </strong>
            <span class="timestamp">{{ message.timestamp | date: 'short' }}</span>
          </div>
          @if (message.sender === 'user') {
            <div class="message-content user-content">{{ message.content }}</div>
          } @else {
            <div class="message-content system-content">
              <markdown [data]="message.content"></markdown>
            </div>
          }
        </div>
      }

      @if (waiting()) {
        <div class="system-message">
          <div class="loading-indicator">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span>{{ content().loading }}</span>
          </div>
        </div>
      }
    </div>

    <div class="textarea-container textarea-container-top">
      <ion-textarea
        [(ngModel)]="currentMessage"
        (keyup.enter)="sendMessage()"
        [placeholder]="content().askHere"
      >
      </ion-textarea>
      <div class="button-container">
        <ion-button (click)="sendMessage()" [disabled]="!currentMessage.trim()">{{
          content().chat
        }}</ion-button>
        <ion-button (click)="clearChat()">{{ content().clear }}</ion-button>
        <ion-button (click)="readMenu()" [disabled]="waiting()">{{ content().menu }}</ion-button>
        <ion-button (click)="sumarizeBottle()" [disabled]="waiting()">{{
          content().bottle
        }}</ion-button>
      </div>
    </div>
  </div>
</ion-content>
